<!DOCTYPE html><html lang=en-GB><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="IE=edge" http-equiv=X-UA-Compatible><link href=/favicon.ico rel=icon sizes=any><link href=/apple-touch-icon.png rel=apple-touch-icon><link href=/manifest.webmanifest rel=manifest><link href=https://deloughry.co.uk/posts/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker/ rel=canonical><title>Using MongoDB’s Data API, Next.js with SWR to make a page click tracker. • Deloughry.co.uk</title><meta content="Using MongoDB’s Data API, Next.js with SWR to make a page click tracker. • Deloughry.co.uk" name=title><meta content="While building my new website, I wanted to understand its traffic, especially the logs, which contain both short and long-form posts. I aimed to identify which posts performed better or worse." name=description><meta content="Matthew Peck-Deloughry" name=author><meta content=#DDDFDF name=theme-color><meta content=article property=og:type><meta content="Using MongoDB’s Data API, Next.js with SWR to make a page click tracker." property=og:title><meta content="While building my new website, I wanted to understand its traffic, especially the logs, which contain both short and long-form posts. I aimed to identify which posts performed better or worse." property=og:description><meta content=https://deloughry.co.uk/posts/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker/ property=og:url><meta content=Deloughry.co.uk property=og:site_name><meta content=en_GB property=og:locale><meta content=https://deloughry.co.uk/og-image/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker.png property=og:image><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content="Matthew Peck-Deloughry" property=article:author><meta content=2022-04-19T23:00:00.000Z property=article:published_time><meta content=summary_large_image property=twitter:card><meta content=https://deloughry.co.uk/posts/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker/ property=twitter:url><meta content="Using MongoDB’s Data API, Next.js with SWR to make a page click tracker." property=twitter:title><meta content="While building my new website, I wanted to understand its traffic, especially the logs, which contain both short and long-form posts. I aimed to identify which posts performed better or worse." property=twitter:description><meta content=https://deloughry.co.uk/og-image/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker.png property=twitter:image><link href=/rss.xml rel=alternate title=Deloughry.co.uk type=application/rss+xml><script>!function(){const e={author:"Matthew Peck-Deloughry",title:"Deloughry.co.uk",description:"A little hovel of Mine",lang:"en-GB",ogLocale:"en_GB",githubUrl:"https://github.com/DR-DinoMight/deloughry-v2",themeColorLight:"#DDDFDF",themeColorDark:"#191919"},t=document.documentElement,o=document.querySelector("meta[name='theme-color']");function a(){const a="dark"===(console.log("data",typeof localStorage,localStorage.getItem("theme")),"undefined"!=typeof localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme"):window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");console.log("watchTheme",a);new MutationObserver((()=>{const a=t.classList.contains("dark");o.setAttribute("content",e[a?"themeColorDark":"themeColorLight"])})).observe(t,{attributeFilter:["class"]}),t.classList.toggle("dark",a)}document.addEventListener("DOMContentLoaded",a),document.addEventListener("astro:after-swap",a)}()</script><link href=https://webmention.io/deloughry.co.uk/webmention rel=webmention><link href=https://webmention.io/deloughry.co.uk/xmlrpc rel=pingback><meta content=true name=astro-view-transitions-enabled><meta content=animate name=astro-view-transitions-fallback><link href=/_astro/about.D-Nua4CU.css rel=stylesheet><style>@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-new(*),::view-transition-old(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}</style><link href=/_astro/_post_.CyfQd-72.css rel=stylesheet><script src=/_astro/hoisted.EovF1rPx.js type=module></script><script src=/_astro/page.CY1iZwUD.js type=module></script><script>window.va=window.va||function(){(window.vaq=window.vaq||[]).push(arguments)};var script=document.createElement("script");script.defer=!0,script.src="/_vercel/insights/script.js";var head=document.querySelector("head");head.appendChild(script)</script><style>[data-astro-transition-scope=astro-7ibiritp-1]{view-transition-name:post-titleusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker}@layer astro{::view-transition-old(post-titleusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(post-titleusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(post-titleusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(post-titleusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-7ibiritp-1],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-7ibiritp-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-7ibiritp-1],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-7ibiritp-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-7ibiritp-1],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-7ibiritp-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-7ibiritp-1],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-7ibiritp-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-76dyonkk-2]{view-transition-name:post-dateusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker}@layer astro{::view-transition-old(post-dateusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(post-dateusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(post-dateusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(post-dateusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-76dyonkk-2],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-76dyonkk-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-76dyonkk-2],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-76dyonkk-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-76dyonkk-2],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-76dyonkk-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-76dyonkk-2],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-76dyonkk-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-3wpscyb4-3]{view-transition-name:post-descusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker}@layer astro{::view-transition-old(post-descusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(post-descusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(post-descusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(post-descusing-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-3wpscyb4-3],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-3wpscyb4-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-3wpscyb4-3],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-3wpscyb4-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-3wpscyb4-3],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-3wpscyb4-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-3wpscyb4-3],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-3wpscyb4-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-tzwrtu2g-4]{view-transition-name:header}@layer astro{::view-transition-old(header){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(header){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(header){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(header){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-tzwrtu2g-4],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-tzwrtu2g-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-tzwrtu2g-4],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-tzwrtu2g-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-tzwrtu2g-4],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-tzwrtu2g-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-tzwrtu2g-4],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-tzwrtu2g-4]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-l7phgyim-5]{view-transition-name:now-playing}@layer astro{::view-transition-old(now-playing){animation-duration:90ms,220ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1),cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both,both;animation-name:astroFadeOut,astroSlideToLeft}::view-transition-new(now-playing){animation-duration:210ms,220ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1),cubic-bezier(0.76,0,0.24,1);animation-delay:30ms;animation-fill-mode:both,both;animation-name:astroFadeIn,astroSlideFromRight}[data-astro-transition=back]::view-transition-old(now-playing){animation-name:astroFadeOut,astroSlideToRight}[data-astro-transition=back]::view-transition-new(now-playing){animation-name:astroFadeIn,astroSlideFromLeft}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-l7phgyim-5],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-l7phgyim-5]{animation-duration:90ms,220ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1),cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both,both;animation-name:astroFadeOut,astroSlideToLeft}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-l7phgyim-5],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-l7phgyim-5]{animation-duration:210ms,220ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1),cubic-bezier(0.76,0,0.24,1);animation-delay:30ms;animation-fill-mode:both,both;animation-name:astroFadeIn,astroSlideFromRight}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-l7phgyim-5],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-l7phgyim-5]{animation-name:astroFadeOut,astroSlideToRight}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-l7phgyim-5],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-l7phgyim-5]{animation-name:astroFadeIn,astroSlideFromLeft}</style></head><body><a href=#main class="focus:fixed focus:left-1 focus:not-sr-only focus:top-1.5 sr-only">skip to content</a><header class="flex items-center group mb-8 relative sm:pl-[4.5rem]" id=main-header><div class="flex sm:flex-col"><a href=https://deloughry.co.uk class="grayscale font-oswald hover:filter-none inline-flex items-center noj-underline sm:inline-block sm:relative" rel=author><img alt="A dino skull" src=/_astro/logo-small.Nmiy0Dm2_1DNQAO.webp aria-hidden=true class="mr-3 sm:absolute sm:left-[-4.5rem] sm:mr-0 sm:w-16 w-8" decoding=async height=130 loading=eager width=130> <span class="no-underline font-bold sm:text-2xl text-xl uppercase">Matthew Peck-Deloughry</span></a><nav aria-label="Main menu" class="sm:py-0 py-4 -inset-x-4 absolute bg-bgColor flex-col gap-y-4 group-[.menu-open]:flex group-[.menu-open]:z-50 h-screen hidden items-end rounded-md shadow sm:-ml-4 sm:backdrop-blur-none sm:bg-transparent sm:divide-accent sm:divide-dashed sm:divide-x sm:flex sm:flex-row sm:h-auto sm:items-center sm:mt-1 sm:rounded-none sm:shadow-none sm:static sm:z-auto text-accent top-14" id=navigation-menu><a href=/ class="sm:py-0 px-4 sm:hover:underline hover:text-link py-4" rel=prefetch>Home </a><a href=/about class="sm:py-0 px-4 sm:hover:underline hover:text-link py-4" rel=prefetch>About </a><a href=/posts class="sm:py-0 px-4 sm:hover:underline hover:text-link py-4" rel=prefetch>Blog </a><a href=/playlists class="sm:py-0 px-4 sm:hover:underline hover:text-link py-4" rel=prefetch>Playlists </a><a href=/projects class="sm:py-0 px-4 sm:hover:underline hover:text-link py-4" rel=prefetch>Projects </a><a href=/bookmarks class="sm:py-0 px-4 sm:hover:underline hover:text-link py-4" rel=prefetch>Bookmarks</a></nav></div><theme-toggle class=ml-auto><button aria-label="Toggle Dark Mode" class="transition-all bg-zinc-200 dark:bg-zinc-700 group h-9 hover:ring-2 p-2 relative ring-zinc-400 rounded-md w-9" id=toggle-theme type=button><svg class="transition-all -translate-x-1/2 -translate-y-1/2 absolute left-1/2 top-1/2 opacity-0 scale-0 h-7 w-7 group-aria-pressed:opacity-100 group-aria-pressed:scale-100" aria-hidden=true fill=none focusable=false stroke-width=1.5 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg id=sun-svg><path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M22 12L23 12" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M12 2V1" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M12 23V22" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M20 20L19 19" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M20 4L19 5" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M4 20L5 19" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M4 4L5 5" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M1 12L2 12" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path></svg> <svg class="transition-all -translate-x-1/2 -translate-y-1/2 absolute left-1/2 top-1/2 opacity-0 scale-0 h-7 w-7 group-aria-[pressed=false]:opacity-100 group-aria-[pressed=false]:scale-100" aria-hidden=true fill=none focusable=false stroke-width=1.5 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg id=moon-svg><circle cx=12 cy=12 r=10 stroke=currentColor stroke-width=1.5></circle><path d="M7.63262 3.06689C8.98567 3.35733 9.99999 4.56025 9.99999 6.00007C9.99999 7.65693 8.65685 9.00007 6.99999 9.00007C5.4512 9.00007 4.17653 7.82641 4.01685 6.31997" stroke=currentColor stroke-width=1.5></path><path d="M22 13.0505C21.3647 12.4022 20.4793 12 19.5 12C17.567 12 16 13.567 16 15.5C16 17.2632 17.3039 18.7219 19 18.9646" stroke=currentColor stroke-width=1.5></path><path d="M14.5 8.51L14.51 8.49889" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path><path d="M10 17C11.1046 17 12 16.1046 12 15C12 13.8954 11.1046 13 10 13C8.89543 13 8 13.8954 8 15C8 16.1046 8.89543 17 10 17Z" stroke=currentColor stroke-linecap=round stroke-linejoin=round></path></svg></button></theme-toggle><button aria-label="Open main menu" class="group relative h-7 ml-8 sm:hidden sm:invisible w-7" id=toggle-navigation-menu type=button aria-expanded=false aria-haspopup=menu><svg class="transition-all -translate-x-1/2 -translate-y-1/2 absolute left-1/2 top-1/2 h-full w-full group-aria-expanded:opacity-0 group-aria-expanded:scale-0" aria-hidden=true fill=none focusable=false stroke-width=1.5 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg id=line-svg stroke=currentColor><path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap=round stroke-linejoin=round></path></svg> <svg class="transition-all -translate-x-1/2 -translate-y-1/2 absolute left-1/2 top-1/2 opacity-0 scale-0 group-aria-expanded:opacity-100 group-aria-expanded:scale-100 h-full text-accent w-full" class=text-accent aria-hidden=true fill=none focusable=false stroke-width=1.5 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg id=cross-svg stroke=currentColor><path d="M6 18L18 6M6 6l12 12" stroke-linecap=round stroke-linejoin=round></path></svg></button></header><main class=flex-1 id=main><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(self.Astro||(self.Astro={})).load=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:load")),(()=>{var t,e=Object.defineProperty,r=(t,r,n)=>(((t,r,n)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n})(t,"symbol"!=typeof r?r+"":r,n),n);{let e={0:t=>i(t),1:t=>s(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(s(t)),5:t=>new Set(s(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},n=t=>{let[r,n]=t;return r in e?e[r](n):void 0},s=t=>t.map(n),i=t=>"object"!=typeof t||null===t?t:Object.fromEntries(Object.entries(t).map((([t,e])=>[t,n(e)])));customElements.get("astro-island")||customElements.define("astro-island",(t=class extends HTMLElement{constructor(){super(...arguments),r(this,"Component"),r(this,"hydrator"),r(this,"hydrate",(async()=>{var t;if(!this.hydrator||!this.isConnected)return;let e=null==(t=this.parentElement)?void 0:t.closest("astro-island[ssr]");if(e)return void e.addEventListener("astro:hydrate",this.hydrate,{once:!0});let r,n=this.querySelectorAll("astro-slot"),s={},o=this.querySelectorAll("template[data-astro-template]");for(let t of o){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(s[t.getAttribute("data-astro-template")||"default"]=t.innerHTML,t.remove())}for(let t of n){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(s[t.getAttribute("name")||"default"]=t.innerHTML)}try{r=this.hasAttribute("props")?i(JSON.parse(this.getAttribute("props"))):{}}catch(t){let e=this.getAttribute("component-url")||"<unknown>",r=this.getAttribute("component-export");throw r&&(e+=` (export ${r})`),console.error(`[hydrate] Error parsing props for component ${e}`,this.getAttribute("props"),t),t}await this.hydrator(this)(this.Component,r,s,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))})),r(this,"unmount",(()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))}))}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(this.hasAttribute("await-children")&&"interactive"!==document.readyState&&"complete"!==document.readyState){let t=()=>{document.removeEventListener("DOMContentLoaded",t),e.disconnect(),this.childrenConnectedCallback()},e=new MutationObserver((()=>{var e;(null==(e=this.lastChild)?void 0:e.nodeType)===Node.COMMENT_NODE&&"astro:end"===this.lastChild.nodeValue&&(this.lastChild.remove(),t())}));e.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",t)}else this.childrenConnectedCallback()}async childrenConnectedCallback(){let t=this.getAttribute("before-hydration-url");t&&await import(t),this.start()}async start(){let t=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(void 0!==Astro[e])try{await Astro[e]((async()=>{let t=this.getAttribute("renderer-url"),[e,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),t?import(t):()=>()=>{}]),n=this.getAttribute("component-export")||"default";if(n.includes(".")){this.Component=e;for(let t of n.split("."))this.Component=this.Component[t]}else this.Component=e[n];return this.hydrator=r,this.hydrate}),t,this)}catch(t){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,t)}else window.addEventListener(`astro:${e}`,(()=>this.start()),{once:!0})}attributeChangedCallback(){this.hydrate()}},r(t,"observedAttributes",["props"]),t))}})()</script><astro-island await-children="" client=load component-export=default component-url=/_astro/NowPlaying.PvKf4MFA.js data-astro-transition-persist=now-playing data-astro-transition-scope=astro-l7phgyim-5 opts={&quot;name&quot;:&quot;NowPlaying&quot;,&quot;value&quot;:true} prefix=r0 props={&quot;data-astro-transition-persist&quot;:[0,&quot;now-playing&quot;],&quot;data-astro-transition-scope&quot;:[0,&quot;astro-l7phgyim-5&quot;]} renderer-url=/_astro/client.Cvlxmu5W.js ssr="" uid=ZWnTDO><div class="transition-all align-middle duration-250 ease-in-out flex flex-col invisible justify-center"><p class=min-h-[102px]>Spotify Not Playing</p></div></astro-island><div class="sm:gap-x-10 sm:grid sm:grid-cols-[5fr] sm:grid-flow-col sm:items-start"><article class="break-words h-entry"><div id=blog-hero><h1 class="p-name title" data-astro-transition-scope=astro-7ibiritp-1>Using MongoDB’s Data API, Next.js with SWR to make a page click tracker.</h1><a href=https://deloughry.co.uk/posts/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker/ class=u-url><time class=dt-published data-astro-transition-scope=astro-76dyonkk-2 datetime=2022-04-19T23:00:00.000Z>2022-04-19T23:00:00.000Z</time></a><div class="before:content-['|'] inline"><svg class="inline-block h-6 w-6" aria-hidden=true fill=none focusable=false stroke-width=1.5 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg stroke=currentColor stroke-linecap=round stroke-linejoin=round><path d="M0 0h24v24H0z" stroke=none fill=none></path><path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path><path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path><path d="M6 9h-.01"></path></svg> <a href=/tags/til class="cactus-link before:content-['#'] inline-block" aria-label="View more blogs with the tag til">til </a>, <a href=/tags/backend class="cactus-link before:content-['#'] inline-block" aria-label="View more blogs with the tag backend">backend </a>, <a href=/tags/archived class="cactus-link before:content-['#'] inline-block" aria-label="View more blogs with the tag archived">archived</a></div><p class="border-accent border-l-4 mt-8 pl-4 text-lg" data-astro-transition-scope=astro-3wpscyb4-3>While building my new website, I wanted to understand its traffic, especially the logs, which contain both short and long-form posts. I aimed to identify which posts performed better or worse.</p></div><div class="max-w-3xl prose prose-cactus prose-heading:before:mr-4 prose-headings:before:content-['#'] prose-headings:before:flex-row prose-headings:before:text-accent prose-headings:font-semibold prose-sm prose-th:before:content-none w-full"><blockquote><p>As with all my technical documents, I like to preface the articles, that I don’t pretend to be a master in said topic, nor always do stuff the best way, these articles are here as a documentation of my exploration, and if you find this useful then awesome! If you see something you want to discuss please hit me up on twitter as I’m always up for a good chat!</p></blockquote><p>With a new website build, I wanted to learn what traffic was like on my website, more importantly, my “Logs”, as these posts are a mix of short and long forms. I just wanted to see which of these posts were doing better or worse, but I didn’t want to go down the route of using a full-blown tracking service for multiple reasons:</p><ol><li>I don’t want to mess around with the cookies and privacy stuff of Google analytics</li><li>I don’t want to pay for an analytics service, like Fathom or Netlify Analytics package</li><li>Most of the analytic servicers are just way too complicated for just a page counter</li><li>I wanted to get my geek on and make something.</li></ol><p>I knew I’d need some data housing to store the page URLs and clicks, and I’ve recently started playing around with MongoDB’s hosted solution <a href=https://www.mongodb.com/cloud/atlas/ >Atlas</a> for some Data logging of my Air Quality Sensor ( a future log to come, keep an eye out ), and I was super impressed with it and I’ve also not really done much NoSQL before…so to me this seemed like a perfect excuse to play with it again. Heck even if it wasn’t the right tool for me, I love tinkering with something trying to see if I can mould it to fit my needs, for me the best kinds of problems to solve!</p><p>One of the newer features that MongoDB Atlas has is the Data API service this allows you to interact with the mongo database without having to install any extra packages, if you really wanted to you could just interact purely over Curl or WGET without even installing a package. Armed with this you should be able to do a fair bit of stuff in my opinion a lot quicker, and developing a proof of concept that bit easier!</p><p>I’m not going to talk about how to get up and running with MongoDB and their Atlas offering, many smarter and more succinct people have done this, but I want to focus more on the Data API side do the bits that are new to me and hopefully new to you too! With that being said you should be able to get up a running with the free account.</p><p>You’ll want to get a Database that we can use to store the website stats, for me I called this **website **as I plan to have more stats housed here in the future, and then I created a collection called <strong>views</strong>. Now that we have something to store our data in we can get to the fun part and actually start recording.</p><p>First, we need to get the URL endpoint that Data API offers so we can interact with our database, You can find this by going to your Atlas dashboard and then clicking on Data API.</p><p><img alt=test src=https://cdn.sanity.io/images/airrvxef/production/046227717adf50330832e69505241cd16b0c2f79-165x105.png /></p><p>When the screen is loaded make sure you have Data API enabled for the Data source in question</p><p><img alt="Screenshot of Atlas dashboard showing Data AP being enabled" src=https://cdn.sanity.io/images/airrvxef/production/53f807f2f5ee9ec36cb497f80b2e9d479682fbaa-1685x302.png /></p><p>The next step would be to go ahead and generate an API key by clicking the “Create API Key” button, make sure you take note of the key in your into your <code>.env</code> as <code>ATLAS_DATA_KEY</code> as it is only displayed to you the once, finally, copy the endpoint URL, into your .env something like <code>ATLAS_DATA_URL</code></p><p>Now armed with everything that we need from MongoDB we can go ahead and create the functionality in our Next.js project.</p><h3 id=upserting-a-record>Upserting a record.</h3><p>So as we don’t want to have a new Document on each visit we want to make use of upserting documents, this will attempt to find the Document in question and update values but if it can’t find the document it will then go ahead and create the document with the values required. As well as upserting we also don’t want to have to read the document to get a count then increment the document then updating the with the new variable what we actually want to use here is one of Mongo’s super useful and highly powerful operators <code>$inc</code> this will allow us to say in the update call to go get the value of a Field and increment it by a value all in the same call as the update!</p><p>Start by creating a file that we can house the interactions, for me I created <code>/lib/atlas.ts</code></p><p>First, let’s go grab our env variables and store them into a couple of constant variables</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#91b4d5>const</span><span style=color:#e4f0fb> dataUrl</span><span style=color:#91b4d5> =</span><span style=color:#e4f0fb> process</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>env</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>ATLAS_DATA_URL</span><span style=color:#a6accd>;</span></span>
<span class=line><span style=color:#91b4d5>const</span><span style=color:#e4f0fb> dataKey</span><span style=color:#91b4d5> =</span><span style=color:#e4f0fb> process</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>env</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>ATLAS_DATA_KEY</span><span style=color:#a6accd>;</span></span></code></pre><p>Next, create a function that we can call from a Next.js API Endpoint.</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#91b4d5>const</span><span style=color:#add7ff> upsertPageView</span><span style=color:#91b4d5> =</span><span style=color:#5de4c7> async</span><span style=color:#a6accd> (</span><span style=color:#e4f0fb>pageUrl</span><span style=color:#91b4d5>:</span><span style=color:#a6aCCDC0> string</span><span style=color:#a6accd>) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#e4f0fb> response</span><span style=color:#91b4d5> =</span><span style=color:#5de4C7C0> await</span><span style=color:#e4f0FBD0> fetch</span><span style=color:#a6accd>(</span><span style=color:#a6accd>`${</span><span style=color:#e4f0fb>dataUrl</span><span style=color:#a6accd>}</span><span style=color:#5de4c7>/action/updateOne</span><span style=color:#a6accd>`</span><span style=color:#a6accd>, {</span></span>
<span class=line><span style=color:#add7ff>		method</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>POST</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#add7ff>		headers</span><span style=color:#a6accd>:</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#a6accd>			&quot;</span><span style=color:#5de4c7>Access-Control-Request-Headers</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>*</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>			&quot;</span><span style=color:#5de4c7>api-key</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#e4f0fb> dataKey</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>			&quot;</span><span style=color:#5de4c7>Content-Type</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>application/json</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		},</span></span>
<span class=line><span style=color:#add7ff>		body</span><span style=color:#a6accd>:</span><span style=color:#add7ff> JSON</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>stringify</span><span style=color:#a6accd>({</span></span>
<span class=line><span style=color:#add7ff>			dataSource</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>&lt;NAME OF DATASOURCE&gt;</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#add7ff>			database</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>&lt;NAME OF DATABASE&gt;</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#add7ff>			collection</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>&lt;NAME OF COLLECTION&gt;</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#add7ff>			filter</span><span style=color:#a6accd>:</span><span style=color:#a6accd> {</span><span style=color:#add7ff> name</span><span style=color:#a6accd>:</span><span style=color:#e4f0fb> pageUrl</span><span style=color:#a6accd> },</span></span>
<span class=line><span style=color:#add7ff>			update</span><span style=color:#a6accd>:</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#add7ff>				$inc</span><span style=color:#a6accd>:</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#add7ff>					views</span><span style=color:#a6accd>:</span><span style=color:#5de4c7> 1</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>				},</span></span>
<span class=line><span style=color:#a6accd>			},</span></span>
<span class=line><span style=color:#add7ff>			upsert</span><span style=color:#a6accd>:</span><span style=color:#5de4c7> true</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		}),</span></span>
<span class=line><span style=color:#a6accd>	});</span></span>
<span class=line><span style=color:#5de4C7C0>	return</span><span style=color:#5de4C7C0> await</span><span style=color:#e4f0fb> response</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>json</span><span style=color:#a6accd>();</span></span>
<span class=line><span style=color:#a6accd>};</span></span></code></pre><p>To explain this a little, we are first defining the URL we to send the request to using the constants variable <code>dataUrl</code> with the addition of <code>/action/updateOne</code> which is the endpoint we are after this is the endpoint we are <code>POST</code>ing too and the rest of the endpoints are defined <a href=https://docs.atlas.mongodb.com/api/data-api-resources/#base-url>here</a> if you are interested (we’ll be using another one later on in the post).</p><p>The next bit is the headers we need to allow us to interact with MongoDB’s Data API standard stuff, with the addition of <code>api-key</code> which is using the API key that we stored earlier in the <code>.env</code>.</p><p>Onto the fun bit of the function and that’s actually the body of the request! We first make a JSON string stating our common bits like dataSource, database, and collection ( granted these could be made a bit DRYer, but I like to get stuff working then tidy up later!).</p><p>When doing updates to MongoDB we need to first tell MongoDB which document we want to update this is done by using the <code>filter</code> bit, we pass in an object on a key and value we want to use as a search so we want to find the document with a <code>name</code> of the passed in variable <code>pageUrl</code> for this post, we’ll use my last (b)log post <code>/logs/work-in-progress</code> (<a href=https://deloughry.co.uk/logs/work-in-progress>why not give it a read?</a>).</p><p>The last two bits of the body are the really juicy bits, first, we need to define the fields of the document we are going to be updating in our case that’s <code>views</code> but as mentioned earlier we want to increment the number of views and not have to go fetch the document, read then update, so we can pass in a helper function that MongoDB provides and that’s the <code>$inc</code> operator this accepts another key-value object which can be multiple fields you’d like to update but in our case, we only need to do the one field, so we pass in the field <code>views</code> and how much we’d like to increment by which is 1 ( this could also be a negative number if you wanted to decrease). The final bit that allows us to do the real magic that is the <code>&quot;upsert&quot;: true</code> this tells MongoDB that if you don’t find the record to update then insert it!.</p><p>To be able to access this helper function we want a new bit of middleware to <code>/page/_middleware.ts</code> this will allow us to send the page view increment on page load.</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>{</span><span style=color:#add7ff> NextRequest</span><span style=color:#a6accd>,</span><span style=color:#add7ff> NextResponse</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &#39;</span><span style=color:#5de4c7>next/server</span><span style=color:#a6accd>&#39;</span></span>
<span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>{</span><span style=color:#add7ff> upsertPageView</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>../lib/atlas</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>;</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#5de4c7>export</span><span style=color:#e4f0FBD0> functionmiddleware</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>req</span><span style=color:#a6accd>: </span><span style=color:#e4f0fb>NextRequest</span><span style=color:#a6accd>) {</span></span>
<span class=line><span style=color:#91b4d5>  const</span><span style=color:#a6accd> { </span><span style=color:#e4f0fb>pathname</span><span style=color:#a6accd> } </span><span style=color:#91b4d5>=</span><span style=color:#e4f0fb> req</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>nextUrl</span></span>
<span class=line><span style=color:#e4f0FBD0>  upsertPageView</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>pathname</span><span style=color:#a6accd>)</span></span>
<span class=line><span style=color:#a6accd>}</span></span></code></pre><p>Now, this is nowhere near the perfect solution for this and will require more work before I suggest using it in production ( I’d love to see some solutions to the problems again hit me up on Twitter ), such as being able to rate limit it so that you don’t spam out page views to Atlas, only counting the visitor the once if visited the page in quick succession, and the last which is what we’ll cover a basic solution now and that’s to add a block list of pages/resources you don’t want to track.</p><p>Back in the <code>/lib/atlas.ts</code> file create a new function something like:</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#91b4d5>const</span><span style=color:#add7ff> isBlockedURL</span><span style=color:#91b4d5> =</span><span style=color:#a6accd> (</span><span style=color:#e4f0fb>pathName</span><span style=color:#91b4d5>:</span><span style=color:#a6aCCDC0> string</span><span style=color:#a6accd>) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#767C9DB0;font-style:italic>	//Create an block list of urls that should not be tracked some examples are</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#e4f0fb> blockList</span><span style=color:#91b4d5> =</span><span style=color:#a6accd> [</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>/api</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>/images</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.jpg</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.png</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.svg</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.ico</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.css</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.js</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.json</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.woff</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.woff2</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.ttf</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.eot</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.otf</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		&quot;</span><span style=color:#5de4c7>.webmanifest</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>	];</span></span>
<span class=line></span>
<span class=line><span style=color:#5de4C7C0>	return</span><span style=color:#e4f0fb> blockList</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>some</span><span style=color:#a6accd>((</span><span style=color:#e4f0fb>url</span><span style=color:#a6accd>) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#e4f0fb> pathName</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>includes</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>url</span><span style=color:#a6accd>));</span></span>
<span class=line><span style=color:#a6accd>};</span></span></code></pre><p>Then back in the <code>_middleware.ts</code>file change the code to be</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>{</span><span style=color:#add7ff> NextRequest</span><span style=color:#a6accd>,</span><span style=color:#add7ff> NextResponse</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &#39;</span><span style=color:#5de4c7>next/server</span><span style=color:#a6accd>&#39;</span></span>
<span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>{</span><span style=color:#add7ff> upsertPageView</span><span style=color:#a6accd>,</span><span style=color:#add7ff> isBlockedURL</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>../lib/atlas</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>;</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#5de4c7>export</span><span style=color:#e4f0FBD0> functionmiddleware</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>req</span><span style=color:#a6accd>: </span><span style=color:#e4f0fb>NextRequest</span><span style=color:#a6accd>) {</span></span>
<span class=line><span style=color:#91b4d5>  const</span><span style=color:#a6accd> { </span><span style=color:#e4f0fb>pathname</span><span style=color:#a6accd> } </span><span style=color:#91b4d5>=</span><span style=color:#e4f0fb> req</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>nextUrl</span></span>
<span class=line><span style=color:#a6accd>  if (</span><span style=color:#91b4d5>!</span><span style=color:#e4f0FBD0>isBlockedURL</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>pathname</span><span style=color:#a6accd>) {</span></span>
<span class=line><span style=color:#add7ff>		upsertPageView</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>pathname</span><span style=color:#a6accd>)</span></span>
<span class=line><span style=color:#a6accd>	}</span></span>
<span class=line><span style=color:#a6accd>}</span></span></code></pre><p>This will take the URL and check that it isn’t present in the list of endpoints we are not interested in and return if it should be blocked or not.</p><p>And with that you are recording the page views if you start viewing pages, you should start seeing entries in Atlas like the following.</p><p><img alt="Screenshot showing the log entry stored in Atalas" src=https://cdn.sanity.io/images/airrvxef/production/ca5752c440d86a5d5dcd8f1848bc6732e6bc00d5-362x123.png /></p><p>Mine will be slightly different as I have added an <code>updatedAt</code> attribute to mine, but for intents and purposes it should roughly look the same and you could call it finished depending on what you want to do with the data, however, let’s extend this further and read the data back into the website so we can show the page views that the (b)logs are getting.</p><h3 id=displaying-the-pages-views>Displaying the pages views</h3><p>Displaying the page views is actually quite simple all we need to do is make use of a new call to Atlas that, is somewhat similar to the one to update the page counter, pair that with <a href=https://swr.vercel.app/ >SWR</a> we can pull the latest page views and display that next to a listing or on the page itself.</p><p>Back in <code>/lib/atlas.ts</code> let us create a new function that we can go and search for the page in question and return it if found.</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#91b4d5>const</span><span style=color:#add7ff> getPageViewCount</span><span style=color:#91b4d5> =</span><span style=color:#5de4c7> async</span><span style=color:#a6accd> (</span><span style=color:#e4f0fb>pageUrl</span><span style=color:#91b4d5>:</span><span style=color:#a6aCCDC0> string</span><span style=color:#a6accd> ) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#91b4d5>  const</span><span style=color:#e4f0fb> response</span><span style=color:#91b4d5> =</span><span style=color:#e4f0FBD0> awaitfetch</span><span style=color:#a6accd>(</span><span style=color:#a6accd>`${</span><span style=color:#e4f0fb>dataUrl</span><span style=color:#a6accd>}</span><span style=color:#5de4c7>/action/findOne</span><span style=color:#a6accd>`</span><span style=color:#a6accd>, {</span></span>
<span class=line><span style=color:#add7ff>    method</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &#39;</span><span style=color:#5de4c7>POST</span><span style=color:#a6accd>&#39;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#add7ff>    headers</span><span style=color:#a6accd>:</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#a6accd>      &#39;</span><span style=color:#5de4c7>Access-Control-Request-Headers</span><span style=color:#a6accd>&#39;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &#39;</span><span style=color:#5de4c7>*</span><span style=color:#a6accd>&#39;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>      &#39;</span><span style=color:#5de4c7>api-key</span><span style=color:#a6accd>&#39;</span><span style=color:#a6accd>:</span><span style=color:#e4f0fb> dataKey</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>      &#39;</span><span style=color:#5de4c7>Content-Type</span><span style=color:#a6accd>&#39;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &#39;</span><span style=color:#5de4c7>application/json</span><span style=color:#a6accd>&#39;</span></span>
<span class=line><span style=color:#a6accd>    },</span></span>
<span class=line><span style=color:#add7ff>    body</span><span style=color:#a6accd>:</span><span style=color:#add7ff> JSON</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>stringify</span><span style=color:#a6accd>({</span></span>
<span class=line><span style=color:#a6accd>      &quot;</span><span style=color:#5de4c7>dataSource</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>&lt;NAME OF DATASOURCE&gt;</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>      &quot;</span><span style=color:#5de4c7>database</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>&lt;NAME OF DATABASE&gt;</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>      &quot;</span><span style=color:#5de4c7>collection</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>&lt;NAME OF COLLECTION&gt;</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>      &quot;</span><span style=color:#5de4c7>filter</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#a6accd>        &quot;</span><span style=color:#5de4c7>name</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>:</span><span style=color:#e4f0fb>pageUrl</span></span>
<span class=line><span style=color:#a6accd>}</span></span>
<span class=line><span style=color:#a6accd>    })</span></span>
<span class=line><span style=color:#a6accd>  });</span></span></code></pre><p>As you have seen this function is very similar to the upserting of the page, the difference being that we <code>POST</code>-ing to a new URL this time it’s <code>/findOne</code> and the body of the request is slightly different, as we don’t need to alter any data all we are interested in is finding the document that has the same name as what we have passed through.</p><p>The next step is to create an API endpoint in our local API folder that we can use with SWR that keeps calling this function so we can get a constant status of the pageviews, I created a route <code>/api/pagesviews.ts</code> which will house the code to call the function we created earlier and just output the results of that as its response.</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>type</span><span style=color:#a6accd> {</span><span style=color:#add7ff> NextApiRequest</span><span style=color:#a6accd>,</span><span style=color:#add7ff> NextApiResponse</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>next</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>;</span></span>
<span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>{</span><span style=color:#add7ff> getPageViewCount</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>../../lib/atlas</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>;</span></span>
<span class=line></span>
<span class=line><span style=color:#5de4c7>export default async </span><span style=color:#91b4d5>function</span><span style=color:#add7ff> handler</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>req</span><span style=color:#91b4d5>:</span><span style=color:#a6aCCDC0> NextApiRequest</span><span style=color:#a6accd>,</span><span style=color:#e4f0fb> res</span><span style=color:#91b4d5>:</span><span style=color:#a6aCCDC0> NextApiResponse</span><span style=color:#a6accd>)</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#767C9DB0;font-style:italic>	// Get the query string parameter url.</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#a6accd> {</span><span style=color:#e4f0fb> u</span><span style=color:#a6accd> }</span><span style=color:#91b4d5> =</span><span style=color:#e4f0fb> req</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>query</span><span style=color:#a6accd>;</span></span>
<span class=line></span>
<span class=line><span style=color:#767C9DB0;font-style:italic>	// If no url provided, return an 0</span></span>
<span class=line><span style=color:#a6accd>	if</span><span style=color:#a6accd> (</span><span style=color:#91b4d5>!</span><span style=color:#e4f0fb>u</span><span style=color:#a6accd>)</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#e4f0fb>		res</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>status</span><span style=color:#a6accd>(</span><span style=color:#5de4c7>200</span><span style=color:#a6accd>).</span><span style=color:#e4f0FBD0>json</span><span style=color:#a6accd>({</span></span>
<span class=line><span style=color:#add7ff>			pageviews</span><span style=color:#a6accd>:</span><span style=color:#5de4c7> 0</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>		});</span></span>
<span class=line><span style=color:#a6accd>	}</span></span>
<span class=line></span>
<span class=line><span style=color:#767C9DB0;font-style:italic>	// Otherwise, return the number of pageviews for the provided url</span></span>
<span class=line><span style=color:#767C9DB0;font-style:italic>	// call  getPageViewCount(url)</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#e4f0fb> pageviews</span><span style=color:#91b4d5> =</span><span style=color:#5de4C7C0> await</span><span style=color:#e4f0FBD0> getPageViewCount</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>u</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>toString</span><span style=color:#a6accd>());</span></span>
<span class=line><span style=color:#e4f0fb>	res</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>status</span><span style=color:#a6accd>(</span><span style=color:#5de4c7>200</span><span style=color:#a6accd>).</span><span style=color:#e4f0FBD0>json</span><span style=color:#a6accd>({</span></span>
<span class=line><span style=color:#add7ff>		views</span><span style=color:#a6accd>:</span><span style=color:#e4f0fb> pageviews</span><span style=color:#a6accd>,</span></span>
<span class=line><span style=color:#a6accd>	});</span></span>
<span class=line><span style=color:#a6accd>}</span></span></code></pre><p>The snippets shows that we are passing the URL via a query string, we could do this by looking at the body among a few other different techniques, but ultimately what we need to do in the API endpoint is get the URL in question and pass that through as a parameter to the function we created earlier.</p><p>Having created the API handler we can get on to the last and arguably the most fun bit of this post and that is being able to display the page views in a component that can be used in multiple areas of the website.</p><p>In your components directory, you want to create a new component called PageViews <code>/components/PageViews.tsx</code> and in this we want to use SWR to go off to our internal API call and fetch the pages we’re interested in, so the following code should sort us on this:</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#5de4c7>import </span><span style=color:#add7ff>useSWR</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>swr</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>;</span></span>
<span class=line><span style=color:#5de4c7>import </span><span style=color:#a6accd>{</span><span style=color:#add7ff> useRouter</span><span style=color:#a6accd> }</span><span style=color:#a6accd> from</span><span style=color:#a6accd> &quot;</span><span style=color:#5de4c7>next/router</span><span style=color:#a6accd>&quot;</span><span style=color:#a6accd>;</span></span>
<span class=line><span style=color:#91b4d5>const</span><span style=color:#add7ff> fetcher</span><span style=color:#91b4d5> =</span><span style=color:#a6accd> (</span><span style=color:#e4f0fb>url</span><span style=color:#91b4d5>:</span><span style=color:#a6aCCDC0> string</span><span style=color:#a6accd>) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#e4f0FBD0> fetch</span><span style=color:#a6accd>(</span><span style=color:#e4f0fb>url</span><span style=color:#a6accd>).</span><span style=color:#e4f0FBD0>then</span><span style=color:#a6accd>((</span><span style=color:#e4f0fb>r</span><span style=color:#a6accd>) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#e4f0fb> r</span><span style=color:#a6accd>.</span><span style=color:#e4f0FBD0>json</span><span style=color:#a6accd>());</span></span>
<span class=line></span>
<span class=line><span style=color:#91b4d5>const</span><span style=color:#add7ff> PageViews</span><span style=color:#91b4d5> =</span><span style=color:#a6accd> ({ </span><span style=color:#e4f0fb>url</span><span style=color:#a6accd>, </span><span style=color:#e4f0fb>className</span><span style=color:#a6accd> }</span><span style=color:#91b4d5>:</span><span style=color:#a6accd> { url</span><span style=color:#91b4d5>?:</span><span style=color:#a6aCCDC0> string</span><span style=color:#a6accd>; className</span><span style=color:#91b4d5>?:</span><span style=color:#a6aCCDC0> string</span><span style=color:#a6accd> }) </span><span style=color:#91b4d5>=&gt;</span><span style=color:#a6accd> {</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#e4f0fb> router</span><span style=color:#91b4d5> =</span><span style=color:#e4f0FBD0> useRouter</span><span style=color:#a6accd>();</span></span>
<span class=line></span>
<span class=line><span style=color:#767C9DB0;font-style:italic>	// if url is not provided, use the current url</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#e4f0fb> queryUrl</span><span style=color:#91b4d5> =</span><span style=color:#e4f0fb> url</span><span style=color:#91b4d5> ||</span><span style=color:#e4f0fb> router</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>query</span><span style=color:#a6accd>.</span><span style=color:#e4f0fb>url</span><span style=color:#a6accd>;</span></span>
<span class=line><span style=color:#91b4d5>	const</span><span style=color:#a6accd> { </span><span style=color:#e4f0fb>data</span><span style=color:#a6accd> } </span><span style=color:#91b4d5>=</span><span style=color:#e4f0FBD0> useSWR</span><span style=color:#a6accd>(</span><span style=color:#a6accd>`</span><span style=color:#5de4c7>/api/pageviews?u=</span><span style=color:#a6accd>${</span><span style=color:#e4f0fb>queryUrl</span><span style=color:#a6accd>}`</span><span style=color:#a6accd>, </span><span style=color:#e4f0fb>fetcher</span><span style=color:#a6accd>);</span></span>
<span class=line></span>
<span class=line><span style=color:#5de4C7C0>	return</span><span style=color:#a6accd> &lt;</span><span style=color:#a6aCCDC0>span</span><span style=color:#a6aCCDC0> className</span><span style=color:#a6accd>={className}&gt;{</span><span style=color:#e4f0fb>data?.views || </span><span style=color:#5de4c7>0</span><span style=color:#a6accd>}</span><span style=color:#91b4d5>&lt;/</span><span style=color:#e4f0fb>span</span><span style=color:#91b4d5>&gt;</span><span style=color:#a6accd>;</span></span>
<span class=line><span style=color:#a6accd>};</span></span>
<span class=line></span>
<span class=line><span style=color:#5de4c7>export default </span><span style=color:#e4f0fb>PageViews</span><span style=color:#a6accd>;</span></span></code></pre><p>Picking the above code apart we are using <code>next/router</code> to get the current URL just in case we don’t pass anything through in the props, this is nice as it means if we wanted to display the page views of the page we are currently well we don’t have to pass anything through to the component as it can automatically pick it up. Then the next bit is using SWR to go off and get our current page view counter, then lastly we return that as <code>&lt;span&gt;</code> passing through the <code>className</code> attribute from the calling of the component so that we can add styles however we like.</p><p>Finally, if we want to display this we only have to call the component the area we want to display the counter, for me I wanted to display it on the (b)log listing screen:</p><pre class="astro-code poimandres" style=background-color:#1b1e28;color:#a6accd;overflow-x:auto tabindex=0><code><span class=line><span style=color:#e4f0fb>&lt;</span><span style=color:#5de4c7>div</span><span style=color:#e4f0fb>&gt;</span><span style=color:#a6accd>Views </span><span style=color:#e4f0fb>&lt;</span><span style=color:#d0679d>PageViews</span><span style=color:#5fb3a1;font-style:italic> url</span><span style=color:#a6accd>=</span><span style=color:#add7ff>{</span><span style=color:#5fb3a1;font-style:italic>`</span><span style=color:#d0679d>/logs/${log.slug.current}`}</span><span style=color:#5fb3a1;font-style:italic> className</span><span style=color:#a6accd>=</span><span style=color:#add7ff>{</span><span style=color:#5fb3a1;font-style:italic>`${categoryTextColor}`}</span><span style=color:#e4f0fb>/&gt;&lt;/</span><span style=color:#5de4c7>div</span><span style=color:#e4f0fb>&gt;</span></span></code></pre><p>Resulting in the following output (notice the Views section) or alternatively look at the top of the post 😀</p><p><img alt="Screenshot of my post listing showing view counter in action" src=https://cdn.sanity.io/images/airrvxef/production/2451ab50b3b0862a67cb6b70f622712a534f224b-952x245.png /></p><p>And there we have it! We’ve used MongoDB, SWR and Next.js to create a tiny little analytical counter that isn’t bloated, it is anonymous and end of the day it is a fun exercise in how to achieve a basic insight into your website. Now I’ve already mentioned that it is code that I’ve thrown together as a learning exercise and there could tons of extra wins that can be made and there may even be a few security improvements to be made, so why not take what I’ve shown today and build upon it and share it with me, I’d love to see where people take this!</p><p>But thanks for sticking around and reading what is my first tutorial post, please drop me a message and Twitter if you have any questions, and until next time av’a good’en! 👋</p></div></article><aside class="sm:block hidden sm:sticky sm:top-20 text-right"><h2 class=font-semibold>Table of Contents</h2><ul class="mt-4 space-y-5 text-xs"><li class="hover:text-link font-bold font-oswald line-clamp-2 text-accent uppercase"><a href=#upserting-a-record aria-label="Scroll to section: Upserting a record."># Upserting a record.</a></li><li class="hover:text-link font-bold font-oswald line-clamp-2 text-accent uppercase"><a href=#displaying-the-pages-views aria-label="Scroll to section: Displaying the pages views"># Displaying the pages views</a></li></ul></aside></div><button aria-label="Back to Top" class="transition-all opacity-0 bg-zinc-200 border-2 border-transparent bottom-8 dark:bg-zinc-700 data-[show=true]:opacity-100 data-[show=true]:translate-y-0 duration-300 fixed flex h-10 hover:border-zinc-400 items-center justify-center right-4 rounded-full sm:h-12 sm:right-8 sm:w-12 text-3xl translate-y-28 w-10 z-90" id=to-top-btn data-show=false><svg class="h-6 w-6" aria-hidden=true fill=none focusable=false stroke-width=2 viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg stroke=currentColor><path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap=round stroke-linejoin=round></path></svg></button></main><footer class="flex items-center justify-center align-top flex-col gap-y-2 mt-auto pb-4 pt-20 sm:flex-row sm:justify-between sm:text-xs text-center w-full"><div class="mr-0 sm:mr-4">Copyright &copy; 2024 <span aria-label="rocket emoji">🦖</span></div><nav aria-label="More on this site" class="flex gap-x-2 sm:divide-accent sm:divide-dashed sm:divide-x sm:gap-x-0"><a href=/ class="sm:py-0 px-4 sm:hover:underline cactus-link py-2 sm:px-2" rel=prefetch>Home </a><a href=/about class="sm:py-0 px-4 sm:hover:underline cactus-link py-2 sm:px-2" rel=prefetch>About </a><a href=/posts class="sm:py-0 px-4 sm:hover:underline cactus-link py-2 sm:px-2" rel=prefetch>Blog </a><a href=/playlists class="sm:py-0 px-4 sm:hover:underline cactus-link py-2 sm:px-2" rel=prefetch>Playlists </a><a href=/projects class="sm:py-0 px-4 sm:hover:underline cactus-link py-2 sm:px-2" rel=prefetch>Projects </a><a href=/bookmarks class="sm:py-0 px-4 sm:hover:underline cactus-link py-2 sm:px-2" rel=prefetch>Bookmarks</a></nav></footer><vercel-speed-insights data-params={&#34;post&#34;:&#34;using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker&#34;} data-pathname=/posts/using-mongodb-s-data-api-next-js-with-swr-to-make-a-page-click-tracker/ data-props={}></vercel-speed-insights></body></html>